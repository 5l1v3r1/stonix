###############################################################################
#                                                                             #
# Copyright 2019. Triad National Security, LLC. All rights reserved.          #
# This program was produced under U.S. Government contract 89233218CNA000001  #
# for Los Alamos National Laboratory (LANL), which is operated by Triad       #
# National Security, LLC for the U.S. Department of Energy/National Nuclear   #
# Security Administration.                                                    #
#                                                                             #
# All rights in the program are reserved by Triad National Security, LLC, and #
# the U.S. Department of Energy/National Nuclear Security Administration. The #
# Government is granted for itself and others acting on its behalf a          #
# nonexclusive, paid-up, irrevocable worldwide license in this material to    #
# reproduce, prepare derivative works, distribute copies to the public,       #
# perform publicly and display publicly, and to permit others to do so.       #
#                                                                             #
###############################################################################

#!/usr/bin/python
import os
import shutil
import sys

TARGET_LOCATION = sys.argv[2]


def removeOldStonix(target):
    try:
        shutil.rmtree(target)
    except OSError:
        print "Could not find " + str(target)
    return 0

def backupOldStonixConf(target):
    '''
    If the target conf file exists, stonix will be using it to save the users
    settings, regarless of whether or not /etc/stonix.conf exists. Newer
    versions of stonix will no longer put a conf file in the application path,
    so this should now be moved to /etc.
    '''
    conffile = target + "/Contents/Resources/stonix.app/Contents/" + \
        "Resources/stonix.conf"
    if os.path.exists(conffile) and not os.path.islink(conffile):
        os.rename(conffile, "/etc/stonix.conf")


if __name__ == "__main__":
    target = os.path.join(TARGET_LOCATION + "Applications/stonix4mac.app")
    backupOldStonixConf(target)
    sys.exit(removeOldStonix(target))
